Root = (StructDef | Function)* ;

StructDef = "struct" Identifier "{" VarDecl* "}" ;

VarDeclPrefix = Type Identifier ;

VarDecl = VarDeclPrefix ";" ;

Function = "fun" Type Identifier "(" VarDeclPrefix ,* "," ")" "{" Statement* "}" ;

Statement = VarDecl | Assignment | Expr | "return" Expr ;

//Assignment = `filter { Expr; allow: ID, QID; } "=" Expr ";" ;
Assignment = Expr "=" Expr ";" ;

Type = ("int" | Identifier) "*"* ;

Integer %= [0-9]+ ;

Identifier %= ([a-z] | [A-Z])+ ;

Expr = `cluster {

    @+_left_assoc
    -> Expr "+" Expr
    -> Expr "-" Expr

    @+_left_assoc
    -> Expr "*" Expr
    -> Expr "/" Expr

    @+
    -> "*" Expr
    -> "&" Expr

    @+_left_recur
    -> Expr ("." Identifier)+

    @+
    -> "(" drop Expr ")"
    -> Identifier "(" drop Expr ,* "," ")"
    -> Identifier "(" drop Expr ,* "," ")"
    -> Identifier
    -> "-"? Integer
};